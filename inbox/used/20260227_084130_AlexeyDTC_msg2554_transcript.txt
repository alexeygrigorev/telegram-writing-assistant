---
source: telegram_voice
date: 2026-02-27T08:41:30+00:00
user_id: 822266080
username: AlexeyDTC
audio_file: 20260227_084130_AlexeyDTC_msg2554.ogg
---

что я тем временем пока вот мы вчера на пока вчера я ждал чего я временем тем временем дел во первых
я посмотрел как делать backup и такие которые в terraform стоит не попадают до для меня это было
сюрпризом что они попадают terraform стоит и удаляются вместе с базой я сделал такие backup и
которые не удаляются до потом backup я вас 3 сделал чтоб шел идет еще сделал лямбду которая допустим
в два ночи там автоматический backup да то есть она где-то в 3 запускается и из этого
автоматического backup делает копию база то есть меня получается копия продакшена создается вот и
этот snapshot он где-то применим применяется ну не знаю где-то там не знаю 20-30 минут может
понадобится, чтобы установить базу. Поэтому эта лямбда засыпает, и следующая просыпается, ну, в
смысле, заканчивает работать. Следующая через полчаса где-то поднимается. Это я все через Step
Functions оркестрирую. Следующая запускается через полчаса где-то, проверяет, что база создана и что
она живая. То есть она делает запрос, типа там, select count email email останавливает, то есть оно
не удаляет, оно останавливает базу. В таком случае я плачу только за данные то есть я не плачу за
работу базы плачу только за данные и после того как все проверяю останавливаю свою базу я удаляю
вчерашнюю если со вчерашнего дня есть база какая-то которая также спит я ее удаляю то есть меня
получается каждый день работающая реплика зачем я это сделал во-первых я хочу тестировать что я
действительно из бэкапа могу установить базу первое и второе если что-то такое случится чтоб я мог
просто трафик перевести на backup и все вот ну не знаю насколько я так делать или нет но вот чтобы
была такая возможность потенциально да во первых во вторых я давал возможность там в terraform есть
такая возможность запрещать удалять ресурс в самом Terraform и в AWS тоже есть флажок запрещать
удалять ресурс. Я и там и там делать он же через и двое села и может все эти флажки убрать то есть
во-первых флажок с этого ну короче если вдруг что-то случится с агентом и опять я уснул то в
принципе вот мне как раз от этого хочется защиту сделать чтобы не случилось так что я что-то ну
пропущу и чтобы опять случился то есть типа она у нас же создался дубликат поэтому мы это флажок
отключаем и удаляем теперь еще раз вот чтобы такого не произошло мне хочется чтобы был всегда backup
плюс backup и на из 3 они тоже в этом плане могут быть надежнее простого это я тоже добавил не могут
надежно потому что с 3 бакет ты с файлами не удалишь просто так нужно сначала все файлы удалить
потом пакет то есть это дополнительная защита то есть если чё можно как минимум остановить и
добавить там retention в версионировании, то есть если ты удаляешь, то у тебя остается версия старая
до удаления. retention 10 чет диплоить в продакшен так себе идея во вторых хотя с другой стороны я
же тоже столько раз делал но для меня неважно в 10 это или не здесь и но вот оказалось что в этот
раз я проспал во вторых все-таки Terraform Plan и Terraform Apply, это не те функции, которые нужно
давать агенту делать, это нужно самому делать. Вот это я понял. Буду ли я делать так опять в
будущем? Ну, возможно, буду. Поэтому я для себя заранее делаю так, чтобы, если вдруг такое опять
произойдет, чтобы меня был backup такой который не в terraform чтобы я мог его восстановить сам
руками вот ну вот так вот да сейчас я просто жду чтобы жду ответа а ну да я еще самое главное что
сделал чтобы у меня стейт был в S3, а не локально. Поэтому у меня же... Я исходил из того, что у
меня стейт уже в S3, а не локально для Terraform. Вот, оказалось, что он локальный, поэтому
создалась копия. Все инфры.